<?php if (!defined('inpanel')) die("no access");global $config;global $content;include "lang/".$_SESSION["mwclang"]."/".$_SESSION["mwclang"]."_faq.php";ob_start();$faqhandle = opendir("./faq");if ($_GET["actf"]=="un" && $_GET["f"]!="aboutgame" && $_GET["f"]!="statistic"){ $faq_title = substr($_GET["f"],0,20); if (file_exists("faq/".$faq_title)) {  @unlink("faq/".$faq_title);  unset($faql[$faq_title]);  $fhandle = fopen("lang/".$_SESSION["mwclang"]."/".$_SESSION["mwclang"]."_faq.php", "w");  $infile = '<?php if (!defined("insite")){die("no access");}'.chr(13).chr(10);  foreach ($faql as $id=>$value)  {   $infile.='$faql["'.$id.'"]="'.$value.'";'.chr(13).chr(10);  }  flock($fhandle,LOCK_EX);  fwrite ($fhandle,$infile);  flock($fhandle,LOCK_UN);  fclose($fhandle);  WriteLogs ("Adm_","Аккаунт ".$_SESSION["user"]." удалил модуль $faq_title");  header("Location: ".$config["siteaddress"]."/control.php?page=faqadd"); } else echo "не могу найти файл ".$faq_title;}$banchars = array("<?","?>","<?php","script");if ($_REQUEST["add"] or $_REQUEST["edit"]){  $faq_title = str_replace($banchars,"",str_replace("\n","&lt;br&gt;",stripslashes($_POST["filetitle"]))); $faq_body = str_replace($banchars,"",$_POST["fileconst"]); $faqfname = $_POST["langtit"]; if (strlen($faq_title)>2 && strlen($faq_body)>2) {  if ($_REQUEST["add"])  {   if (is_file("faq/".$faq_title)) die ("file exests choose another name!");  }  $fhandle = fopen("faq/".$faq_title, "w+");  flock($fhandle,LOCK_EX);  fwrite ($fhandle,$faq_body);  flock($fhandle,LOCK_UN);  fclose($fhandle);  if($_REQUEST["add"])  {   $fhandle = fopen("lang/".$_SESSION["mwclang"]."/".$_SESSION["mwclang"]."_faq.php", "a+");   flock($fhandle,LOCK_EX);   fwrite ($fhandle,'$faql["'.$faq_title.'"]="'.$faqfname.'";'.chr(13).chr(10));   flock($fhandle,LOCK_UN);   fclose($fhandle);  }  else  {   $fhandle = fopen("lang/".$_SESSION["mwclang"]."/".$_SESSION["mwclang"]."_faq.php", "w");   $infile = '<?php if (!defined("insite")){die("no access");}'.chr(13).chr(10);   $faql[$faq_title]=$faqfname;   foreach ($faql as $id=>$value)   {    $infile.='$faql["'.$id.'"]="'.$value.'";'.chr(13).chr(10);   }   flock($fhandle,LOCK_EX);   fwrite ($fhandle,$infile);   flock($fhandle,LOCK_UN);   fclose($fhandle);  }  WriteLogs ("Adm_","Аккаунт ".$_SESSION["user"]." добавил/отредактировал модуль $faq_title");  header("Location: ".$config["siteaddress"]."/control.php?page=faqadd");  unset($faq_title,$faq_body); }}$content->out_content("_sysvol/_a/theme/faqadd_h.html"); while (false !== ($file = readdir($faqhandle))) {  if ($file != "." && $file != "..")  {	if(substr($file,4,3)!="php" && $file!=".htaccess")	{	 if($file!="aboutgame" && $file!="statistic")	 { 	    $content->set('|file|', $file);	    $content->set('|delete|', "<a href=\"". $config["siteaddress"]."/control.php?page=faqadd&actf=un&f=".$file."\">[delete]</a>");	 }	 else	 {	   $content->set('|file|', $file);	   $content->set('|delete|', "");	 }		 $content->set("|title_file|", $faql[trim($file)]);	 $content->out_content("_sysvol/_a/theme/faqadd_h_c.html");	} } 			}		closedir($faqhandle);$content->out_content("_sysvol/_a/theme/faqadd_c.html");if ($_GET["actf"]=="add" or $_GET["actf"]=="ed"){ if($_GET["actf"]=="ed") {  $faq_title = $_GET["f"];  $faqfname = $_GET["f"];  if (is_file("faq/".$faq_title)) $faq_body = file_get_contents("faq/".$faq_title);  else unset($faq_title,$faq_body,$faqfname); } $content->set("|faq_titles|", $faq_title); $content->set("|titlang|", $faql[$faq_title]); $content->set("|faq_modcontent|", str_replace("&lt;br&gt;","\n",stripslashes($faq_body))); if ($_GET["actf"]=="add")    $content->set("|faq_but|", "value=\"add\" name=\"add\""); else if($_GET["actf"]=="ed")    $content->set("|faq_but|", "value=\"edit\" name=\"edit\""); $content->out_content("_sysvol/_a/theme/faqadd_modul.html");}$temp = ob_get_contents();ob_end_clean();